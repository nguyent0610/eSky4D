@using Ext.Net;
@using Ext.Net.MVC;
@using HQ.eSkyFramework;
@using HQ.eSkyFramework.HQControl;
@using SI21600;
@{
    Layout = null;
    var X = Html.X();
    var HQ = Html.HQ();
}

@(X.Viewport()
.Layout(LayoutType.Fit)
.Items(
    X.FormPanel()
    .ID("frmMain")
    .BodyPadding(0)
    .KeyMap(Util.SetupKeyMap())
    .TopBar(Util.SetupToolbar("Print", true, ""))
    .Region(Region.Center)
    .Layout(LayoutType.Border)
    .Listeners(l =>
    {
        l.BoxReady.Handler = "firstLoad();";
        l.FieldChange.Fn = "frmChange";
    })
    .FieldDefaults(act => { act.LabelAlign = LabelAlign.Right; act.LabelWidth = 150; })
    .Items(
        X.Panel().Region(Region.North)
        .Items(
        HQ.Combo().ID("cboType").Name("cboType").HQLangCode("SI21600_Type").HQProcedure("SI21600_pcType").HQAutoLoad(false)
        .HQColumnShow("Code,Descr").DisplayField("Descr").ValueField("Code")
        .Width(300).HQHeightWidth(300, 300).MarginSpec("5 5 5 0")
        .LoadData()
        .Listeners(lst =>
        {
            lst.TriggerClick.Fn = "cboType_TriggerClick";
            lst.Change.Fn = "cboType_Change";
            lst.Expand.Fn = "cboType_Expand"; 
        })
    )
        , X.Panel()
        .Split(true)
        .Region(Region.West).AutoScroll(true).MinWidth(310)
        .Items(
            X.TreePanel().ID("IDTree").Width(300)
            .MarginSpec("5 5 5 5")
            .Title(Util.GetLang("Tree"))
            .UseArrows(true)
            .Border(false)
            .Animate(true)
            .SelectionModel(X.TreeSelectionModel().ID("slmTree").Mode(SelectionMode.Multi))
            .Listeners(lst =>
            {
                lst.ItemClick.Fn = "NodeSelected_Change";
            })
        )//TreeView
        
        , X.Panel()
        .Region(Region.Center)
      
        .Items(
            HQ.Combo().ID("cboNodeID").Name("cboNodeID").HQLangCode("ID").HQProcedure("SI21600_pcHierarchyAll")
            .HQColumnShow("NodeID,Descr").DisplayField("NodeID").ValueField("NodeID").HQAutoLoad(false)
            .HQHeightWidth(400, 300).MarginSpec("5 0 5 0")
            .HQParam(new StoreParameterCollection() 
            { 
                new StoreParameter() { Name = "@Type", Value = "App.cboType.getValue()", Mode = ParameterMode.Raw }
            })
            .LoadData()
            .Listeners(lst =>
                {
                    //lst.TriggerClick.Handler = "if (index == 0) { this.clearValue();}";
                    lst.Change.Fn = "cboNodeID_Change";
                    lst.Select.Fn = "cboNodeID_Select";
                    //lst.Focus.Handler = "this.forceSelection = true;";

                })
            , HQ.TextBox().ID("txtDescr").Name("Descr").HQLangCode("Descr").DataIndex("Descr")
                                .Width(500).MaxLength(200).EnforceMaxLength(true)
            , HQ.NumberField().ID("txtNodeLevel").Name("txtNodeLevel").HQLangCode("Level")
                                .Width(300).MinValue(0).DecimalPrecision(0).ReadOnly(true)
            , HQ.NumberField().ID("txtParentRecordID").Name("txtParentRecordID").HQLangCode("ParentRecordID")
                                .Width(300).MinValue(0).DecimalPrecision(0).ReadOnly(true)
        )//Form
    )
)
)

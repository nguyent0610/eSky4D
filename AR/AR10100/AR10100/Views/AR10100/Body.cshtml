@using Ext.Net;
@using Ext.Net.MVC;
@using HQ.eSkyFramework;
@using HQ.eSkyFramework.HQControl;
@using AR10100;
@{
    Layout = null;
    var X = Html.X();
    var HQ = Html.HQ();
    ViewBag.Title = "AR10100";
    ViewBag.OrdFromId = "";
}
@(
 Html.X().Viewport().Layout(LayoutType.Fit)
.Items(
        X.FormPanel()
        .Layout(LayoutType.Anchor)
        .ID("frmMain")
        .TrackResetOnLoad(true)
        .DefaultAnchor("100%")
        .BodyPadding(10)
        //.AutoScroll(true)
        .TopBar(Util.SetupToolbar("Print",true,""))
        .FieldDefaults(act => { act.LabelAlign = LabelAlign.Right; act.LabelWidth = 150; })
        //.Listeners(itm => itm.AfterRender.Fn = "frmloadAfterRender")
        .Listeners(l =>
                {
                    //l.Render.Handler = "HQ.common.control_render(this,'header')";
                    l.BoxReady.Handler = "firstLoad();";
                    l.FieldChange.Fn = "frmChange";
                })
        .Items(
            //X.Panel().ID("Header").Layout(LayoutType.Anchor)
            //.Items(
            
                X.FormPanel()
                .ID("frmTop")
                .Layout(LayoutType.Anchor)
                .AnchorVertical("20%")
                //.Title(Util.GetLang("DOC"))
                .Padding(5)
                .Listeners(lst =>
                        {
                            lst.BoxReady.Fn = "setValueBranchID";
                            lst.Render.Handler = "HQ.common.control_render(this,'headerTop')";
                        })
                .Items(
                        
                 
                X.Container().Layout(LayoutType.HBox).MarginSpec("0 0 0 0").AnchorHorizontal("100%")
                .Items(
                   //Bat.No
                    HQ.Combo().ID("cboBatNbr").Name("cboBatNbr").HQLangCode("BATNBR").HQProcedure("AR10100_pcBatch")
                    .HQColumnShow("BatNbr,TotAmt,Descr,Status").DisplayField("BatNbr").ValueField("BatNbr").Editable(false)
                    .Width(300).HQHeightWidth(400, 500).MarginSpec("5 0 0 0")//.ForceSelection(false)
                    .HQDBSys(false)//.MaxLength(30).EnforceMaxLength(true)
                    //.Triggers(new FieldTrigger() { Icon = TriggerIcon.Clear, HideTrigger = false })
                    .HQParam(new StoreParameterCollection()
                    {
                        new StoreParameter() { Name = "@BranchID", Value = "HQ.cpnyID", Mode = ParameterMode.Raw },
                        new StoreParameter() { Name = "@ScreenNbr", Value = ViewBag.Title, Mode = ParameterMode.Value }
                    })
                    .LoadData()
                    .Listeners(lst =>
                        {
                            //lst.TriggerClick.Handler = "if (index == 0) { this.clearValue();}";
                         
                            
                            lst.Change.Fn = "cboBatNbr_Change";
                            lst.Select.Fn = "cboBatNbr_Select";
                            lst.Expand.Fn = "cboBatNbr_Expand";
                       
                        })

                    //BrandID    
                    ,HQ.TextBox().ID("txtBranchID").Name("txtBranchID").HQLangCode("BRANCHID")
                    .Width(300).MarginSpec("5 0 5 0").MaxLength(200).EnforceMaxLength(true).AllowBlank(false)
                    .ReadOnly(true).Value(Current.CpnyID.ToString())
                    .Listeners(lst =>
                    {

                        //lst.Change.Fn = "txtDescr_Change";
                                    
                    })
                    //BrandID     Hide
                    ,HQ.TextBox().ID("txtBranchIDHide").Name("txtBranchIDHide")
                    .Width(300).MarginSpec("5 0 5 0").MaxLength(200).EnforceMaxLength(true).AllowBlank(false)
                    .ReadOnly(true).Hidden(true).Value(Current.CpnyID.ToString())
               
                    
                    //Status
                    ,HQ.Combo().ID("cboStatus").Name("cboStatus").HQLangCode("STATUS").HQProcedure("AR10100_pcGetStatus")
                    .HQColumnShow("Code,Descr").DisplayField("Descr").ValueField("Code").DataIndex("Status")
                    .Width(300).HQHeightWidth(400, 500).MarginSpec("5 0 0 0")//.Disabled(true)
                    .HQDBSys(false).ReadOnly(true)//.HQValue("H",false)
                    //.MaxLength(30).EnforceMaxLength(true)
                    //.Triggers(new FieldTrigger() { Icon = TriggerIcon.Clear, HideTrigger = false })
                    .HQParam(new StoreParameterCollection()
                    {
                        new StoreParameter() { Name = "@LangID", Value = "HQ.langID", Mode = ParameterMode.Raw }
                    })
                    .LoadData()
                    .Listeners(lst =>
                        {
                            //lst.TriggerClick.Handler = "if (index == 0) { this.clearValue();}";
                            lst.Change.Fn = "cboStatus_Change";
                            //lst.Focus.Fn = "Focus1_Change";
                        })   
                        
                         
                    //ngoac ket thuc dan hang ngang 3 combo  dau form         
                    )
                    
                    
                      ,X.Container().Layout(LayoutType.HBox).MarginSpec("0 0 0 0").Width(1235)
                    .Items(
                    //internal Ref
                    HQ.TextBox().ID("txtOrigRefNbr").Name("txtOrigRefNbr").HQLangCode("INTREFNBR").DataIndex("IntRefNbr")
                    .Width(300).MarginSpec("5 0 5 0").MaxLength(10).EnforceMaxLength(true)
                    
                    .Listeners(lst =>
                    {

                        //lst.Change.Fn = "txtDescr_Change";
                                    
                    })
                    
                    //Xu ly (Handle)   
                    ,HQ.Combo().ID("cboHandle").Name("cboHandle").HQLangCode("HANDLE").HQProcedure("AR10100_pcHandle")
                    .HQColumnShow("Code,Descr").DisplayField("Descr").ValueField("Code")
                    .Width(300).HQHeightWidth(400, 500).MarginSpec("5 0 0 0").ForceSelection(false).AllowBlank(false)
                    .HQDBSys(false)//.MaxLength(30).EnforceMaxLength(true)
                    .Triggers(new FieldTrigger() { Icon = TriggerIcon.Clear, HideTrigger = false })
                    .HQParam(new StoreParameterCollection()
                    {
                        new StoreParameter() { Name = "@Status", Value = "App.cboStatus.value", Mode = ParameterMode.Raw },
                        //@Role nay sua sau
                        
                        new StoreParameter() { Name = "@LangID", Value = "HQ.langID", Mode = ParameterMode.Raw }
                    })
                    .LoadData()
                    .Listeners(lst =>
                        {
                            lst.TriggerClick.Handler = "if (index == 0) { this.clearValue();}";
                            //lst.Change.Fn = "cboCustId_Change";
                            lst.Focus.Handler = "this.forceSelection = true;";
                        }) 
                    
                    ,HQ.NumberField().ID("txtCuryCrTot").Name("txtCuryCrTot").HQLangCode("TOTAMT").DataIndex("TotAmt")
                    .Width(300).MarginSpec("5 0 0 0").ReadOnly(true)    
                        
                        
                //ngoac ket thuc dan hang ngang 3 combo  sau form
                )
                
                 // xu ly cai nay sau Canncelled Batch
                    ,HQ.TextBox().ID("txtRvdBatNbr").Name("txtRvdBatNbr").HQLangCode("CANCELLEDBATNBR").DataIndex("RvdBatNbr")
                    .Width(300).MarginSpec("5 0 5 0").MaxLength(200).EnforceMaxLength(true)
                    .ReadOnly(true)
                    .Listeners(lst =>
                    {

                        //lst.Change.Fn = "txtDescr_Change";
                                    
                    })

                //ngoac dong frmTop
                )
                , X.TabPanel()
                //.Layout(LayoutType.Fit)
                .Anchor("100% -120")
                //.AutoScroll(true)
                .ID("tabAtAR10100")
                .Listeners(p =>
                {  
                    p.AfterRender.Handler = "tabSA_Setup_AfterRender(this, 100)";
                    //p.TabChange.Fn = "Focus1_Change";
                })
                .Items(
                        X.FormPanel()
                        .ID("frmBot")
                        .Layout(LayoutType.Anchor)
                        .AnchorVertical("100%")
                        .Title(Util.GetLang("DOC"))
                        .Padding(5)
                        .Items(
                        
                        
                            X.Panel() 
                            .Layout(LayoutType.Anchor)
                               
                            .Listeners(l =>
                            {
                                l.Render.Handler = "HQ.common.control_render(this,'headerBot')";
                   
                            })
                            .Items(
              
                                 X.Container().Layout(LayoutType.HBox).MarginSpec("0 0 0 0").AnchorHorizontal("100%")
                                .Items(
                                    //Doctype     
                                    HQ.Combo().ID("cboDocType").Name("cboDocType").HQLangCode("DOCTYPE").HQProcedure("AR10100_pcDocType")
                                    .HQColumnShow("Code,Descr").DisplayField("Descr").ValueField("Code").DataIndex("DocType").AllowBlank(false)
                                    .Width(300).HQHeightWidth(400, 500).MarginSpec("5 0 0 0")//.LabelWidth(90)//.Disabled(true)
                                    .HQDBSys(false).ForceSelection(false)//.HQValue("CC",false)
                                    //.MaxLength(30).EnforceMaxLength(true)
                                    //.Triggers(new FieldTrigger() { Icon = TriggerIcon.Clear, HideTrigger = false })
                                    .HQParam(new StoreParameterCollection()
                                    {
                                        new StoreParameter() { Name = "@LangID", Value = "HQ.langID", Mode = ParameterMode.Raw }
                                    })
                                    .LoadData()
                                    .Listeners(lst =>
                                        {
                                            //lst.TriggerClick.Handler = "if (index == 0) { this.clearValue();}";
                                            //lst.Change.Fn = "cboStatus_Change";
                                            lst.Focus.Handler = "this.forceSelection = true;";
                                        })
                            
                                
                                    //RefNbr
                                    ,HQ.Combo().ID("cboRefNbr").Name("cboRefNbr").HQLangCode("REFNBR").HQProcedure("AR10100_pcRefNbr")
                                    .HQColumnShow("RefNbr,DocType,OrigDocAmt,DocDesc").DisplayField("RefNbr").ValueField("RefNbr").Editable(false)
                                    .Width(300).HQHeightWidth(400, 500).MarginSpec("5 0 0 0")//.LabelWidth(90)//.Disabled(true)
                                    .HQDBSys(false)
                                    //.MaxLength(30).EnforceMaxLength(true)
                                    //.Triggers(new FieldTrigger() { Icon = TriggerIcon.Clear, HideTrigger = false })
                                    .HQParam(new StoreParameterCollection()
                                    {
                                       // new StoreParameter() { Name = "@UserID", Value = "HQ.userName", Mode = ParameterMode.Raw }
                                        new StoreParameter() { Name = "@BranchID", Value = "HQ.cpnyID", Mode = ParameterMode.Raw },
                                        new StoreParameter() { Name = "@BatNbr", Value = "App.cboBatNbr.getValue()", Mode = ParameterMode.Raw }
                                    })
                                    .LoadData()
                                    .Listeners(lst =>
                                        {
                                            //lst.TriggerClick.Handler = "if (index == 0) { this.clearValue();}";
                                            lst.Change.Fn = "cboRefNbr_Change";
                                            lst.Select.Fn = "cboRefNbr_Select";
                                            lst.Expand.Fn = "cboRefNbr_Expand";
                                        })    
                                
                                     //SlsperID
                                    ,HQ.Combo().ID("cboSlsperId").Name("cboSlsperId").HQLangCode("SLSPERID").HQProcedure("AR10100_pcSalesPerson")
                                    .HQColumnShow("Slsperid,Name").DisplayField("Slsperid").ValueField("Slsperid").DataIndex("SlsperId")
                                    .Width(300).HQHeightWidth(400, 500).MarginSpec("5 0 0 0")//.LabelWidth(90)//.Disabled(true)
                                    .HQDBSys(false).ForceSelection(false).AllowBlank(false)
                                    //.MaxLength(30).EnforceMaxLength(true)
                                    //.Triggers(new FieldTrigger() { Icon = TriggerIcon.Clear, HideTrigger = false })
                                    .HQParam(new StoreParameterCollection()
                                    {
                                        new StoreParameter() { Name = "@BranchID", Value = "HQ.cpnyID", Mode = ParameterMode.Raw },
                                        new StoreParameter() { Name = "@Username", Value = "HQ.userName", Mode = ParameterMode.Raw },
                                        new StoreParameter() { Name = "@ScreenNbr", Value = ViewBag.Title, Mode = ParameterMode.Value },
                                    })
                                    .LoadData()
                                    .Listeners(lst =>
                                        {
                                            lst.Focus.Handler = "this.forceSelection = true;";
                                        })        
                                
                                   ////Vendor
                                   //,HQ.Combo().ID("cboCustId").Name("cboCustId").HQLangCode("VENDID").HQProcedure("ppv_vendor")
                                   // .HQColumnShow("VendID,name,Address").DisplayField("VendID").ValueField("VendID").DataIndex("VendID").AllowBlank(false)
                                   // .Width(300).HQHeightWidth(400, 500).MarginSpec("5 0 0 0")//.Disabled(true)//.LabelWidth(90)//.Disabled(true)
                                   // .HQDBSys(false).ForceSelection(false)
                                   // //.MaxLength(30).EnforceMaxLength(true)
                                   // //.Triggers(new FieldTrigger() { Icon = TriggerIcon.Clear, HideTrigger = false })
                                   // .HQParam(new StoreParameterCollection()
                                   // {
                                   //    // new StoreParameter() { Name = "@UserID", Value = "HQ.userName", Mode = ParameterMode.Raw }
                                   //    // new StoreParameter() { Name = "@BrandID", Value = "HQ.cpnyID", Mode = ParameterMode.Raw }
                                   // })
                                   // .LoadData()
                                   // .Listeners(lst =>
                                   //     {
                                   //         //lst.TriggerClick.Handler = "if (index == 0) { this.clearValue();}";
                                   //         lst.Change.Fn = "cboVendID_Change";
                                   //         //lst.Focus.Fn = "Focus1_Change";
                                   //     })     
                        
                              
                                

                                //ngoac ket thuc dan hang ngang hang 1 tab 1
                                )
                        
                                 ,X.Container().Layout(LayoutType.HBox).MarginSpec("0 0 0 0").Width(1235)
                                .Items(
                                 
                                     //CustID
                                    HQ.Combo().ID("cboCustId").Name("cboCustId").HQLangCode("CUSTID").HQProcedure("AR10100_pcCustomerActive")
                                    .HQColumnShow("CustID,Name,Addr1,Addr2").DisplayField("CustID").ValueField("CustID").DataIndex("CustId")
                                    .Width(300).HQHeightWidth(400, 500).MarginSpec("5 0 0 0")//.LabelWidth(90)//.Disabled(true)
                                    .HQDBSys(false).ForceSelection(false)
                                    //.MaxLength(30).EnforceMaxLength(true)
                                    //.Triggers(new FieldTrigger() { Icon = TriggerIcon.Clear, HideTrigger = false })
                                    .HQParam(new StoreParameterCollection()
                                    {
                                        new StoreParameter() { Name = "@BranchID", Value = "HQ.cpnyID", Mode = ParameterMode.Raw },
                                        new StoreParameter() { Name = "@Username", Value = "HQ.userName", Mode = ParameterMode.Raw },
                                        new StoreParameter() { Name = "@ScreenNbr", Value = ViewBag.Title, Mode = ParameterMode.Value },
                                    })
                                    .LoadData()
                                    .Listeners(lst =>
                                        {
                                            //lst.TriggerClick.Handler = "if (index == 0) { this.clearValue();}";
                                            lst.Change.Fn = "cboCustId_Change";
                                            lst.Focus.Handler = "this.forceSelection = true;";
                                        })        
                                
                                    //InvcNbr
                                     ,HQ.TextBox().ID("txtInvcNbr").Name("txtInvcNbr").HQLangCode("INVCNBR").DataIndex("InvcNbr")
                                     .Width(225).MarginSpec("5 0 0 0").MaxLength(15).EnforceMaxLength(true)
                                     //InvcNote  
                                    ,HQ.TextBox().ID("txtInvcNote").Name("txtInvcNote").DataIndex("InvcNote")
                                     .Width(75).MarginSpec("5 0 0 0").MaxLength(10).EnforceMaxLength(true)

                                    //Original DocAmount
                                    , HQ.NumberField().ID("txtCuryOrigDocAmt").Name("txtCuryOrigDocAmt").HQLangCode("ORIGDOCAMT").DataIndex("OrigDocAmt")
                                    .Width(300).MarginSpec("5 0 0 0").ReadOnly(true)   
                             
                             
                                //ngoac ket thuc dan hang ngang hang 2 tab 1
                                )
                        
                                 ,X.Container().Layout(LayoutType.HBox).MarginSpec("0 0 0 0").Width(1235)
                                .Items(
                                 
                                    //DocDate
                                    HQ.DateField().ID("txtDocDate").Name("txtDocDate").HQLangCode("DOCDATE").DataIndex("DocDate")
                                    .Width(300).MarginSpec("5 0 0 0").Value(DateTime.Now).AllowBlank(false)
                                    .Listeners(lst =>
                                     {
                                        lst.Change.Fn = "txtDocDate_Change";
                                     })
                            
                            
                                    //Term
                                    ,HQ.Combo().ID("cboTerms").Name("cboTerms").HQLangCode("TERM").HQProcedure("AR10100_pcterms")
                                    .HQColumnShow("TermsID,Descr").DisplayField("TermsID").ValueField("TermsID").DataIndex("Terms").AllowBlank(false)
                                    .Width(300).HQHeightWidth(400, 500).MarginSpec("5 0 0 0")//.LabelWidth(90)//.Disabled(true)
                                    .HQDBSys(false).ForceSelection(false)
                                    //.MaxLength(30).EnforceMaxLength(true)
                                    //.Triggers(new FieldTrigger() { Icon = TriggerIcon.Clear, HideTrigger = false })
                                    .HQParam(new StoreParameterCollection()
                                    {
                                       // new StoreParameter() { Name = "@UserID", Value = "HQ.userName", Mode = ParameterMode.Raw }
                                        //new StoreParameter() { Name = "@BranchID", Value = "HQ.cpnyID", Mode = ParameterMode.Raw },
                                        //new StoreParameter() { Name = "@BatNbr", Value = "App.cboBatNbr.value", Mode = ParameterMode.Raw }
                                    })
                                    .LoadData()
                                    .Listeners(lst =>
                                     {
                                         lst.Change.Fn = "cboTerms_Change";
                                         lst.Focus.Handler = "this.forceSelection = true;";
                                     })

                                    //Currentcy Document
                                    , HQ.NumberField().ID("txtCuryDocBal").Name("txtCuryDocBal").HQLangCode("CURYDOCBAL").DataIndex("DocBal")
                                     .Width(300).MarginSpec("5 0 0 0").ReadOnly(true) 
                            
                            
                            
                                //ngoac ket thuc dan hang ngang hang 3 tab 1
                                )
                        
                                 ,X.Container().Layout(LayoutType.HBox).MarginSpec("0 0 0 0").Width(1235)
                                .Items(
                                   //Due Date = NowDay + Term xu ly sau
                                   HQ.DateField().ID("txtDueDate").Name("txtDueDate").HQLangCode("DUEDATE").DataIndex("DueDate")
                                  .Width(300).MarginSpec("5 0 0 0").Value(DateTime.Now).AllowBlank(false)
                        
                                  //DIscount Date
                                  ,HQ.DateField().ID("txtDiscDate").Name("txtDiscDate").HQLangCode("DISCDATE").DataIndex("DiscDate")
                                  .Width(300).MarginSpec("5 0 0 0").Value(DateTime.Now).AllowBlank(false)
                          
                                  //txtTxblTot
                                  ,HQ.NumberField().ID("txtTxblTot").Name("txtTxblTot").HQLangCode("TXBLAMT").DataIndex("TxblTot00")
                                  .Width(300).MarginSpec("5 0 0 0").ReadOnly(true) 
                        
                          
                        
                                //ngoac ket thuc dan hang ngang hang 4 tab 1
                                )
                        
                                 ,X.Container().Layout(LayoutType.HBox).MarginSpec("0 0 0 0").Width(1235)
                                .Items(
                                 
                                    //DOcument Description
                                    HQ.TextBox().ID("txtDocDescr").Name("txtDocDescr").HQLangCode("DOCDESC").DataIndex("DocDesc")
                                  .Width(600).MarginSpec("5 0 10 0").MaxLength(100).EnforceMaxLength(true)//.AllowBlank(false)
                        
                                  //txtTxblTot
                                  ,HQ.NumberField().ID("txtTaxTot").Name("txtTaxTot").HQLangCode("TAXAMT").DataIndex("TaxTot00")
                                  .Width(300).MarginSpec("5 0 0 0").ReadOnly(true) 
                          
                          
                                //ngoac ket thuc dan hang ngang hang 5 tab 1
                                )
                            
                        //ngoac dong panel bao header bot    
                        )
                        
                        ,Html.X().GridPanel()
                        .Layout(LayoutType.Anchor)
                        //.Frame(true)
                        //.AnchorHorizontal("100%")
                        //.AnchorVertical("50%")
                        //.Height(400)
                        //.Width(1300)
                        .Listeners(p => p.AfterRender.Handler = "tabSA_Setup_AfterRender(this, 140)")
                        .RenderTo("contentCenter")
                        //.AutoScroll(true)
                        .View(X.GridView().TrackOver(false))
                        .ID("grd").SetAutoScroll(true)
                        .StoreID("storeGrid")
                        //.Hidden(true)
                        .SortableColumns(false)
                         .Listeners(lst =>
                        {
                           
                            lst.Render.Handler = "HQ.common.control_render(this,'Grid')";
                        })
                             //.Features(
                             //               Html.X().GridFilters()//Filter
                             //                   .Local(true)
                             //                       .Filters(
                             //                            Html.X().StringFilter().DataIndex("CpnyID"),
                             //                            Html.X().StringFilter().DataIndex("CpnyName")

                             //                       )

                             //           )       
                        .ColumnModel(
                            Html.X().RowNumbererColumn().ID("RowNumber")
                                //LineType Column
                                 , Html.X().Column().Text(Util.GetLang("LineType")).Width(100).DataIndex("LineType")
                                .Editor(
                                  HQ.Combo().ID("cboLineType").Name("cboLineType").HQProcedure("AR10100_pcLineType")
                                  .HQColumnShow("Descr").DisplayField("Descr").ValueField("Code")
                                  .Width(300).HQHeightWidth(500, 400).MarginSpec("5 0 0 0").ForceSelection(true)
                                 .HQParam(new StoreParameterCollection() { 
                                       new StoreParameter() { Name = "@LangID", Value = "HQ.langID", Mode = ParameterMode.Raw }
                                  })
                                  .HQDBSys(false).AllowBlank(false)
                                  .Listeners(lst =>
                                 {
                                     //lst.Change.Fn = "cboCpnyID_Change";
                                 })
                                 .LoadData()

                                 ).Renderer("renderLineType")

                                 //InventoryID collumn (InvtID)
                                 , Html.X().Column().Text(Util.GetLang("InvtID")).Width(100).DataIndex("InvtID")
                                .Editor(
                                  HQ.Combo().ID("cboInvtID").Name("cboInvtID").HQProcedure("AR10100_pcInventoryActiveByBranch")
                                  .HQColumnShow("InvtID,Descr,Descr1,BarCode,Color").DisplayField("InvtID").ValueField("InvtID")
                                  .Width(300).HQHeightWidth(500, 400).MarginSpec("5 0 0 0").ForceSelection(true)
                                 .HQParam(new StoreParameterCollection() { 
                                       new StoreParameter() { Name = "@BranchID", Value = "HQ.cpnyID", Mode = ParameterMode.Raw }
                                  })
                                  .HQDBSys(false).AllowBlank(false)
                                  .Listeners(lst =>
                                 {
                                     //lst.Change.Fn = "cboCpnyID_Change";
                                 })
                                 .LoadData()

                                 )
                                 //quantity
                                 , Html.X().NumberColumn().Format("0,000").ID("txtQty").Align(Alignment.Right).Text(Util.GetLang("Qty")).DataIndex("Qty").Width(100)
                                 .Editor(Html.X().NumberField().EnableKeyEvents(true).MinValue(0).DecimalPrecision(0)
                                 .Listeners(lst =>
                                 {
                                     //lst.Blur.Fn = "txtQty_Blur";
                                     //lst.Change.Fn = "txtQty_Change";
                                     lst.KeyDown.Fn = "validatePossitiveNumber";
                                 })
                                 )
                                 
                                 //Sales Price
                                 , Html.X().NumberColumn().Format("0,000").ID("txtUnitPrice").Align(Alignment.Right).Text(Util.GetLang("SalesPrice")).DataIndex("UnitPrice").Width(150)
                                 .Editor(Html.X().NumberField().MinValue(0).DecimalPrecision(0)
                                 .Listeners(lst =>
                                 {
                                     //lst.Blur.Fn = "txtUnitPrice_Blur";
                                 })
                                 )
                                 
                                 //Extended Amount
                                 , Html.X().NumberColumn().Format("0,000").ID("txtTranAmt").Align(Alignment.Right).Text(Util.GetLang("ExtAmt")).DataIndex("TranAmt").Width(150)
                                 .Editor(Html.X().NumberField().MinValue(0).DecimalPrecision(0)
                                 .Listeners(lst =>
                                 {
                                     //lst.Blur.Fn = "txtTranAmt_Blur";
                                 })
                                 )
                                 
                                 //Description
                                  , Html.X().Column().ID("txtTranDesc").Text(Util.GetLang("Descr")).DataIndex("TranDesc").Width(150)
                                  .Editor(Html.X().TextField())
                                  
                                  //Tax Category
                                 , Html.X().Column().Text(Util.GetLang("TaxCat")).Width(100).DataIndex("TaxCat")
                                .Editor(
                                  HQ.Combo().ID("cboTaxCat").Name("cboTaxCat").HQProcedure("AR10100_pcTaxCat")
                                  .HQColumnShow("CatID,Descr").DisplayField("CatID").ValueField("CatID")
                                  .Width(300).HQHeightWidth(500, 400).MarginSpec("5 0 0 0").ForceSelection(true)
                                 .HQParam(new StoreParameterCollection() { 
                                       //new StoreParameter() { Name = "@BranchID", Value = "HQ.cpnyID", Mode = ParameterMode.Raw }
                                  })
                                  .HQDBSys(false).AllowBlank(false)
                                  .Listeners(lst =>
                                 {
                                     //lst.Change.Fn = "cboTaxCat_Change";
                                 })
                                 .LoadData()
                                 )
                                 //Tax ID
                                //    , Html.X().Column().Text(Util.GetLang("TaxID")).Width(100).DataIndex("TaxId00")//.DataIndex("TaxId01").DataIndex("TaxId02").DataIndex("TaxId03")
                                //.Editor(
                                //    HQ.Combo().ID("cboTaxID").Name("cboTaxID").HQProcedure("AP_VendorTaxes")
                                //    .HQColumnShow("taxid,Descr,TaxRate").DisplayField("taxid").ValueField("taxid")
                                //    .Width(400).HQHeightWidth(500, 400).MarginSpec("5 0 0 0").ForceSelection(false).MultiSelect(true)
                                //    .HQParam(new StoreParameterCollection() { 
                                //    new StoreParameter() { Name = "@VendID", Value = "App.cboCustId.value", Mode = ParameterMode.Raw },
                                //    new StoreParameter() { Name = "@OrdFromId", Value = @ViewBag.OrdFromId , Mode = ParameterMode.Value}
                                //})
                                //    .HQDBSys(false).AllowBlank(false)
                                //    .Listeners(lst =>
                                //    {
                                //        lst.Change.Fn = "cboTaxID_Change";
                                //    })
                                //    .LoadData()
                                //    ).Renderer("RenderTaxId")
                                 
                                //Tax ID
                                , X.TemplateColumn().Text(Util.GetLang("TaxID")).Width(165)
                                .TemplateString("<tpl for=\".\">{TaxId00}<tpl if=\"TaxId01\">,{TaxId01}</tpl><tpl if=\"TaxId02\">,{TaxId02}</tpl><tpl if=\"TaxId03\">,{TaxId03}</tpl></tpl>")
                                .Editor(
                                    HQ.Combo().ID("cboTaxID").Name("cboTaxID").HQProcedure("AR10100_pcCustomerTaxes")
                                    .HQColumnShow("TaxID,Descr,TaxRate").DisplayField("TaxID").ValueField("TaxID")
                                    .Width(500).HQHeightWidth(500, 400).MarginSpec("5 0 0 0").MultiSelect(true).ForceSelection(true)
                                    .HQParam(new StoreParameterCollection() { 
                                    new StoreParameter() { Name = "@CustID", Value = "App.cboCustId.value", Mode = ParameterMode.Raw },
                                    new StoreParameter() { Name = "@ShipToID", Value = "DEFAULT" , Mode = ParameterMode.Value},
                                    new StoreParameter() { Name = "@BranchID", Value = "HQ.cpnyID", Mode = ParameterMode.Raw },
                                })
                                    .HQDBSys(false).AllowBlank(false)
                                    .Listeners(lst =>
                                    {
                                        lst.Change.Fn = "cboTaxID_Change";

                                    })
                                    .LoadData()
                                    )

                              //, Html.X().Column().Text(Util.GetLang("CpnyName")).DataIndex("CpnyName").Width(250).ID("cboCpnyName")
                      
                      
                      , Html.X().CommandColumn().Width(150)
                            .Commands(
                                Html.X().GridCommand()
                                    .Text(Util.GetLang("Reject"))
                                    .ToolTip(t =>
                                    {
                                        t.Text = Util.GetLang("Rejectrowchanges");
                                    })
                                    .CommandName("reject")
                                    .Icon(Icon.ArrowUndo)
                            )
                            
                            
                        .PrepareToolbar(t =>
                        {
                            t.Handler = "toolbar.items.get(0).setVisible(record.dirty);";
                        })
                        .Listeners(l =>
                        {
                            l.Command.Handler = "grd_Reject(record);";
                        })

                        )
                     .SelectionModel(Html.X().RowSelectionModel().ID("slmGridTab1").Mode(SelectionMode.Multi))
                        .Plugins(
                            Html.X()//Cho phep edit )
                                .CellEditing()
                                .ClicksToEdit(1)
                                .Listeners(ls =>
                                {
                                    ls.BeforeEdit.Fn = "grd_BeforeEdit";
                                    ls.Edit.Fn = "grd_Edit";
                                    ls.ValidateEdit.Fn = "grd_ValidateEdit";
                       

                                })
                        //ngoac ket thuc Plugin        
                        )

                  //ngoac ket thuc Grid      
                 )
                , X.Panel()
                .ID("tabTax")
                .Layout(LayoutType.VBox)
                .AnchorHorizontal("100%")
                .AnchorVertical("100%")
                .Padding(5)
                .Title(Util.GetLang("TAX"))
                .LayoutConfig(config => { config.Add(new VBoxLayoutConfig() { Align = VBoxAlign.Stretch }); })
                .CloseAction(CloseAction.Hide)
                //.Disabled(true)
                .Items(
                        //Grid 1 tab 2
                        Html.X().GridPanel()
                        //.Frame(true)
                        //.Layout(LayoutType.VBox)
                        //.AnchorHorizontal("100%")
                        //.AnchorVertical("40%")
                        .Listeners(p => p.AfterRender.Handler = "tabSA_Setup_AfterRender(this, 140)")
                        .Flex(1)
                        .RenderTo("contentCenter")
                        //.AutoScroll(true)
                        .View(X.GridView().TrackOver(false))
                        .ID("grdTopTab2")//.SetAutoScroll(true)
                        .StoreID("storeGridTopTab2")
                        .SortableColumns(false)
                        //.Listeners(l =>
                        //            {
                        //                l.ContainerMouseUp.Fn = "Focus2_Change";
                        //                l.Select.Fn = "Focus2_Change";
                        //                l.BeforeEdit.Fn = "Focus2_Change";
                        //                l.CellClick.Fn = "Focus2_Change";
                        //            })
                            
                        .ColumnModel(
                            Html.X().RowNumbererColumn()
                                //LineType Column
                                 , Html.X().Column().ID("txtLineRef").Text(Util.GetLang("LineRef")).Width(100).DataIndex("LineRef")
                                 , Html.X().Column().ID("txtTaxID").Text(Util.GetLang("TaxID")).Width(100).DataIndex("TaxID")
                                 , Html.X().Column().ID("txtTaxRate").Text(Util.GetLang("TaxRate")).Width(100).DataIndex("TaxRate")
                                 , Html.X().Column().ID("txtTaxAmt").Text(Util.GetLang("TaxAmt")).Width(100).DataIndex("TaxAmt")
                                 , Html.X().Column().ID("txtTxblAmt").Text(Util.GetLang("TxblAmt")).Width(100).DataIndex("TxblAmt")
                                 , Html.X().Column().ID("txtLevel").Text(Util.GetLang("Level")).Width(100).DataIndex("Level")

                            )
                     .SelectionModel(Html.X().RowSelectionModel().ID("slmGridTopTab2").Mode(SelectionMode.Multi))
                     
                     
                     , X.BoxSplitter()
                     //Grid 2 tab 2
                     ,Html.X().GridPanel()
                        //.Frame(true)
                        .Flex(1)
                        //.AnchorHorizontal("100%")
                        //.AnchorVertical("40%")
                        .Listeners(p => p.AfterRender.Handler = "tabSA_Setup_AfterRender(this, 140)")
                        //.RenderTo("contentCenter")
                        //.AutoScroll(true)
                        //.View(X.GridView().TrackOver(false))
                        .ID("grdBotTab2")//.SetAutoScroll(true)
                        .StoreID("storeGridBotTab2")
                        .SortableColumns(false)
                        //.Listeners(l =>
                        //            {
                        //                l.ContainerMouseUp.Fn = "Focus2_Change";
                        //                l.Select.Fn = "Focus2_Change";
                        //                l.BeforeEdit.Fn = "Focus2_Change";
                        //                l.CellClick.Fn = "Focus2_Change";
                        //            })
                            
                        .ColumnModel(
                            Html.X().RowNumbererColumn()
                                //LineType Column
                                 , Html.X().Column().ID("txtTaxRate2").Text(Util.GetLang("TaxRate")).Width(100).DataIndex("TaxRate2")
                                 , Html.X().Column().ID("txtTaxID2").Text(Util.GetLang("TaxID")).Width(100).DataIndex("TaxID2")
                                 , Html.X().Column().ID("txtTaxAmt2").Text(Util.GetLang("TaxAmt")).Width(100).DataIndex("TaxAmt2")
                                 , Html.X().Column().ID("txtTxblAmt2").Text(Util.GetLang("TxblAmt")).Width(100).DataIndex("TxblAmt2")
                            )
                     .SelectionModel(Html.X().RowSelectionModel().ID("slmGridBotTab2").Mode(SelectionMode.Multi))
                     
                     

                 //ngoac ket thuc tab 2 
                 )
                                
                             
                             
                             
                 //ngoac ket thuc tat ca tab (TabPanel)         
                 )


                  
         
                        
                    //ngoac ngoai bao gom panel tren va tab o duoi (header Panel)
                    //)
     

                )

                )





    )
 

@using Ext.Net;
@using Ext.Net.MVC;
@using HQ.eSkyFramework;
@using HQ.eSkyFramework.HQControl;
@using SA40300;
@{
    Layout = null;
    var X = Html.X();
    var HQ = Html.HQ();
    ViewBag.Title = "SA40300";
   
}

@(
Html.X().Viewport().Layout(LayoutType.Fit)
.Items(
        X.FormPanel()
        .Layout(LayoutType.Anchor)
        .ID("frm")
        .Border(false)
        .TrackResetOnLoad(true)
        .DefaultAnchor("100%")
        .BodyPadding(2)
        .TopBar(Util.SetupToolbar("Print",true))
        .FieldDefaults(act => { act.LabelAlign = LabelAlign.Right; act.LabelWidth = 100; })
        .Items(
            X.Panel().ID("Header").Layout(LayoutType.VBox).Width(1035).Border(false )
            .Items(
                 X.Container().Layout(LayoutType.HBox).MarginSpec("0 0 0 0").Width(1235)
                .Items(
                    
                    HQ.Combo().ID("cboMailID").Name("cboMailID").HQLangCode("MailID").HQProcedure("SA40300_pcGetServerMailAutoHeaderIDSubject")
                    .HQColumnShow("MailID,Subject").DisplayField("MailID").ValueField("MailID")//.DataIndex("MailID")
                    .Width(400).HQHeightWidth(400, 300).MarginSpec("5 0 0 0").Delimiter(";")
                    //lưu ý nếu đang làm database Sys thì phải có .HQDBSys(true) và còn 1 cái nữa trong Controller 
                    .HQDBSys(true).MaxLength(30).EnforceMaxLength(true)
                    .Triggers(new FieldTrigger() { Icon = TriggerIcon.Clear, HideTrigger = false })
                    .LoadData()
                    .Listeners(lst =>
                        {
                            lst.TriggerClick.Handler = "if (index == 0) { this.clearValue();}";
                            lst.Change.Fn = "cboMailID_Change";
                            
                            lst.Focus.Fn = "Focus1_Change";
                           
                        })
                    
                    
                    , HQ.Checkbox().ID("chkActive").Name("chkActive").HQLangCode("ACTIVE")
                    .MarginSpec("0 0 0 5").DataIndex("Active").MarginSpec("5 10 0 110").Width(130) 
                    .Listeners(lst =>
                        {
                            lst.Change.Fn = "_recycleMailID_Change";
                        })
                           
                    ,HQ.TextBox().ID("txtHeader").Name("txtHeader").HQLangCode("HEADERMAIL").DataIndex("Header")
                    .Width(400).MarginSpec("5 0 0 0")
                    .Listeners(lst =>
                        {
                            lst.Change.Fn = "_recycleMailID_Change";
                        })
                )  
                    
                , X.Container().Layout(LayoutType.HBox).MarginSpec("0 0 0 0").Width(1235)
                .Items(
                        HQ.Combo().ID("cboMailTo").Name("cboMailTo").HQLangCode("MailTo").HQProcedure("SA40300_pcMail")
                            .HQColumnShow("UserName,Email").DisplayField("Email").ValueField("Email").DataIndex("MailTo")
                            .Width(400).HQHeightWidth(400, 300).MarginSpec("5 0 0 0").MultiSelect(true).Delimiter(";")
                            //lưu ý nếu đang làm database Sys thì phải có .HQDBSys(true) và còn 1 cái nữa trong Controller                             
                            .HQDBSys(true).AllowBlank(true).Editable(false).LoadData()
                            .Listeners(lst =>
                            {
                                lst.Change.Fn = "_recycleMailID_Change";
                            })
                     
                    
                      ,HQ.Combo().ID("cboType").Name("cboType").HQLangCode("SA40300TYPE").HQProcedure("SA40300_pcType")
                            .HQColumnShow("Code,Descr").DisplayField("Descr").ValueField("Code").DataIndex("TypeAuto")
                            .Width(250).HQHeightWidth(400, 300).MarginSpec("5 0 0 0")
                            //lưu ý nếu đang làm database Sys thì phải có .HQDBSys(true) và còn 1 cái nữa trong Controller 
                            .HQDBSys(true).AllowBlank(true).Editable(false)
                            .HQParam(new StoreParameterCollection() 
                                { 
                                   new StoreParameter() { Name = "@LangID", Value = "HQ.langID", Mode = ParameterMode.Raw }
                                })
                            .LoadData()
                            .Listeners(lst =>
                            {
                                lst.Change.Fn = "_recycleMailID_Change";
                            })
                            
                            ,HQ.TextBox().ID("txtBody").Name("txtBody").HQLangCode("BODYMAIL").DataIndex("Body")
                           .Width(400).MarginSpec("5 0 0 0")
                           .Listeners(lst =>
                            {
                                lst.Change.Fn = "_recycleMailID_Change";
                            })
                )
                    
                , X.Container().Layout(LayoutType.HBox).MarginSpec("0 0 0 0").Width(1235)
                .Items(
                    HQ.Combo().ID("cboMailCC").Name("cboMailCC").HQLangCode("MAILCC").HQProcedure("SA40300_pcMail")
                            .HQColumnShow("UserName,Email").DisplayField("Email").ValueField("Email").DataIndex("MailCC")
                            .Width(400).HQHeightWidth(400, 300).MarginSpec("5 0 0 0").MultiSelect(true).Delimiter(";")
                            //lưu ý nếu đang làm database Sys thì phải có .HQDBSys(true) và còn 1 cái nữa trong Controller 
                            .HQDBSys(true).Editable(false).LoadData()
                            .Listeners(lst =>
                            {
                                lst.Change.Fn = "_recycleMailID_Change";
                            })
                    
                            ,HQ.DateField().ID("dtmDateTime").Name("dtmDateTime").HQLangCode("DATE").DataIndex("DateTime")
                           .Width(250).MarginSpec("5 0 0 0").Value(DateTime.Now.ToString()).AllowBlank(true).Editable(false)
                           .Listeners(lst =>
                            {
                                lst.Change.Fn = "_recycleMailID_Change";
                            })
                        
                            ,HQ.TextBox().ID("txtPass").Name("txtPass").HQLangCode("PassUnZip").DataIndex("PassUnZip")
                           .Width(400).MarginSpec("5 0 0 0").InputType(Ext.Net.InputType.Password)
                           .MaxLength(100).EnforceMaxLength(true)
                           .Listeners(lst =>
                            {
                                lst.Change.Fn = "_recycleMailID_Change";
                            })
                        
                )
                ,X.Container().Layout(LayoutType.HBox).MarginSpec("0 0 0 0").Width(1235)
                .Items(
                     HQ.TextBox().ID("txtMailSubject").Name("txtMailSubject").HQLangCode("MAILSUBJECT").DataIndex("Subject")
                    .Width(650).MarginSpec("5 0 0 0").AllowBlank(true)
                    .Listeners(lst =>
                        {
                            lst.Change.Fn = "_recycleMailID_Change";
                        })
                           
                    ,HQ.TextBox().ID("txtNameFile").Name("txtNameFile").HQLangCode("NameFile").DataIndex("FileName")
                    .Width(400).MarginSpec("5 0 0 0").AllowBlank(true)
                    .Listeners(lst =>
                        {
                            lst.Change.Fn = "_recycleMailID_Change";
                        })
                ) 
                             
                
                ,X.Container().Layout(LayoutType.HBox).MarginSpec("0 0 0 0").Width(1235)
                .Items(
                     HQ.TextBox().ID("txtTemplateFile").Name("txtTemplateFile").HQLangCode("TEMPLATEFILE").DataIndex("TemplateFile")
                    .Width(650).MarginSpec("5 0 0 0").AllowBlank(true).MaxLength(250).EnforceMaxLength(true)
                    .Listeners(lst =>
                        {
                            lst.Change.Fn = "_recycleMailID_Change";
                        })

                        , HQ.Checkbox().ID("chkIsAttachFile").Name("chkIsAttachFile").HQLangCode("NotAttachFile")
                        .MarginSpec("0 0 0 5").DataIndex("IsNotAttachFile").MarginSpec("5 10 0 110")
                        .Listeners(lst =>
                        {

                            lst.Change.Fn = "chkIsAttachFile_Change";
                        })
                    
                ) 
                
                ,X.Container().Layout(LayoutType.HBox).MarginSpec("0 0 0 0").Width(1235)
                .Items(
                     HQ.TextBox().ID("txtExportFolder").Name("txtExportFolder").HQLangCode("EXPORTFOLDER").DataIndex("ExportFolder")
                    .Width(650).MarginSpec("5 0 0 0").AllowBlank(true).MaxLength(250).EnforceMaxLength(true)
                    .Listeners(lst =>
                        {
                            lst.Change.Fn = "_recycleMailID_Change";
                        })
                           
                    , HQ.Checkbox().ID("chkIsDeleteFile").Name("chkIsDeleteFile").HQLangCode("NotDeleteFile")
                    .MarginSpec("0 0 0 5").DataIndex("IsNotDeleteFile").MarginSpec("5 10 0 110") 
                    .Listeners(lst =>
                        {
                            lst.Change.Fn = "_recycleMailID_Change";
                        })
                ) 
               
                
                
                
                
                
            )
         
            ,Html.X().GridPanel()
            .Layout(LayoutType.Fit) 
            .MarginSpec("5 0 0 0")            
            .Anchor("100% -155")// WIDTH HEIGHT                 
            .RenderTo("contentCenter")          
            .View(X.GridView().TrackOver(false))
            .ID("grd").SetAutoScroll(true)
            .StoreID("storeMailDetail")          
            .SortableColumns(false)
            .Features(
                        Html.X().GridFilters()//Filter
                            .Local(true)
                                .Filters(
                                        Html.X().StringFilter().DataIndex("ReportViewID"),
                                        Html.X().StringFilter().DataIndex("LoggedCpnyID"),
                                        Html.X().StringFilter().DataIndex("CpnyID"),
                                        Html.X().StringFilter().DataIndex("LangID"),
                                        Html.X().StringFilter().DataIndex("StringParm00"),
                                        Html.X().StringFilter().DataIndex("StringParm01"),
                                        Html.X().StringFilter().DataIndex("StringParm02"),
                                        Html.X().StringFilter().DataIndex("StringParm03"),
                                        Html.X().NumericFilter().DataIndex("BeforeDateParm00"),
                                        Html.X().NumericFilter().DataIndex("BeforeDateParm01"),
                                        Html.X().NumericFilter().DataIndex("BeforeDateParm02"),
                                        Html.X().NumericFilter().DataIndex("BeforeDateParm03"),
                                        Html.X().BooleanFilter().DataIndex("BooleanParm00"),
                                        Html.X().BooleanFilter().DataIndex("BooleanParm01"),
                                        Html.X().BooleanFilter().DataIndex("BooleanParm02"),
                                        Html.X().BooleanFilter().DataIndex("BooleanParm03"),
                                        Html.X().StringFilter().DataIndex("ListParm00"),
                                        Html.X().StringFilter().DataIndex("ListParm01"),
                                        Html.X().StringFilter().DataIndex("ListParm02"),
                                        Html.X().StringFilter().DataIndex("ListParm03")
                                )

              )
            .ColumnModel(
                Html.X().RowNumbererColumn()
                ,Html.X().Column().Text(Util.GetLang("ReportID")).Width(150).DataIndex("ReportID")
                    .Editor(
                     HQ.Combo().ID("cboReportID").Name("cboReportID").HQProcedure("SA40300_pcReport")
                    .HQColumnShow("ReportNbr,Descr").DisplayField("ReportNbr").ValueField("ReportNbr")
                    .Width(300).HQHeightWidth(500, 400).MarginSpec("5 0 0 0")
                    //lưu ý nếu đang làm database Sys thì phải có .HQDBSys(true) và còn 1 cái nữa trong Controller 
                    .HQDBSys(true).AllowBlank(true).Editable(false)
                    .HQParam(new StoreParameterCollection() { 
                    
                    new StoreParameter("@LangID", Current.LangID.ToString(), ParameterMode.Value)
                })
                      .Triggers(new FieldTrigger() { Icon = TriggerIcon.Clear, HideTrigger = false }) 
                     .Listeners(lst =>
                        {
                            lst.Change.Fn = "cboReportID_Change";
                            lst.TriggerClick.Handler = "if (index == 0) { this.clearValue();}"; 
                         
                        })    
                    .LoadData()
                    )

                    , Html.X().Column().Text(Util.GetLang("ReportViewID")).Width(150).DataIndex("ReportViewID")
                        .Editor(
                            HQ.Combo().ID("cboReportViewID").Name("cboReportViewID").HQProcedure("SA40300_pcReportViewID")
                        .HQColumnShow("ReportViewerNbr,Descr").DisplayField("ReportViewerNbr").ValueField("ReportViewerNbr")
                        .Width(300).HQHeightWidth(500, 400).MarginSpec("5 0 0 0").Editable(false)
                        //lưu ý nếu đang làm database Sys thì phải có .HQDBSys(true) và còn 1 cái nữa trong Controller 
                        .HQDBSys(true).AllowBlank(true)
                        .HQParam(new StoreParameterCollection() { 
                                //new StoreParameter("@UserID", Current.UserName, ParameterMode.Value),
                                new StoreParameter("@ReportNbr", "App.cboReportID.value" , ParameterMode.Raw),
                                new StoreParameter("@LangID", "HQ.langID", ParameterMode.Raw)
                            })
                        .Triggers(new FieldTrigger() {Icon = TriggerIcon.Clear, HideTrigger = false })
                             .Listeners(lst =>
                             {
                                 lst.TriggerClick.Handler = "if (index == 0) { this.clearValue();}";
                              
                             })    
                        .LoadData()
                        )
                        
                                                                                        
                                                                                        
                
                      , Html.X().Column().Text(Util.GetLang("LoggedCpnyID")).DataIndex("LoggedCpnyID").Width(150)
                      .Editor(Html.X().TextField())
                        
                      , Html.X().Column().Text(Util.GetLang("CpnyID")).DataIndex("CpnyID").Width(150)
                      .Editor(Html.X().TextField())
                      
                      , Html.X().NumberColumn().Format("0,000").Text(Util.GetLang("LangID")).DataIndex("LangID").Width(150)
                      .Editor(Html.X().TextField().AllowBlank(true))
                      
                      , Html.X().Column().Text(Util.GetLang("StringParm00")).DataIndex("StringParm00").Width(150)
                      .Editor(Html.X().TextField().MaxLength(1000).EnforceMaxLength(true))
                      
                      , Html.X().Column().Text(Util.GetLang("StringParm01")).DataIndex("StringParm01").Width(150)
                      .Editor(Html.X().TextField().MaxLength(1000).EnforceMaxLength(true))  
                      
                      , Html.X().Column().Text(Util.GetLang("StringParm02")).DataIndex("StringParm02").Width(150)
                      .Editor(Html.X().TextField().MaxLength(1000).EnforceMaxLength(true))
                      
                      , Html.X().Column().Text(Util.GetLang("StringParm03")).DataIndex("StringParm03").Width(150)
                      .Editor(Html.X().TextField().MaxLength(1000).EnforceMaxLength(true))
                      
                      , Html.X().NumberColumn().Format("0,000").Text(Util.GetLang("BeforeDateParm00")).DataIndex("BeforeDateParm00").Width(150)
                      .Editor(Html.X().NumberField().AllowBlank(true))
                      
                      , Html.X().NumberColumn().Format("0,000").Text(Util.GetLang("BeforeDateParm01")).DataIndex("BeforeDateParm01").Width(150)
                      .Editor(Html.X().NumberField().AllowBlank(true))
                      
                      , Html.X().NumberColumn().Format("0,000").Text(Util.GetLang("BeforeDateParm02")).DataIndex("BeforeDateParm02").Width(150)
                      .Editor(Html.X().NumberField().AllowBlank(true))
                      
                      , Html.X().NumberColumn().Format("0,000").Text(Util.GetLang("BeforeDateParm03")).DataIndex("BeforeDateParm03").Width(150)
                      .Editor(Html.X().NumberField().AllowBlank(true))
                        
                       , Html.X().CheckColumn().Text(Util.GetLang("BooleanParm00")).DataIndex("BooleanParm00").Width(150).Editable(true)//.Listeners(p=>p.CheckChange.Fn="onCheckChange")                       
                       , Html.X().CheckColumn().Text(Util.GetLang("BooleanParm01")).DataIndex("BooleanParm01").Width(150).Editable(true)//.Listeners(p=>p.CheckChange.Fn="onCheckChange")                       
                       , Html.X().CheckColumn().Text(Util.GetLang("BooleanParm02")).DataIndex("BooleanParm02").Width(150).Editable(true)//.Listeners(p=>p.CheckChange.Fn="onCheckChange")                       
                       , Html.X().CheckColumn().Text(Util.GetLang("BooleanParm03")).DataIndex("BooleanParm03").Width(150).Editable(true)//.Listeners(p=>p.CheckChange.Fn="onCheckChange")
                       
                       
                       , Html.X().Column().Text(Util.GetLang("ListParm00")).DataIndex("ListParm00").Width(150)
                      .Editor(Html.X().TextField())
                      
                      , Html.X().Column().Text(Util.GetLang("ListParm01")).DataIndex("ListParm01").Width(150)
                      .Editor(Html.X().TextField())  
                      
                      , Html.X().Column().Text(Util.GetLang("ListParm02")).DataIndex("ListParm02").Width(150)
                      .Editor(Html.X().TextField())
                      
                      , Html.X().Column().Text(Util.GetLang("ListParm03")).DataIndex("ListParm03").Width(150)
                      .Editor(Html.X().TextField())
                        
                        
                            
                , Html.X().CommandColumn().Width(150)
                .Commands(
                    Html.X().GridCommand()
                        .Text(Util.GetLang("Reject"))
                        .ToolTip(t =>
                        {
                            t.Text = Util.GetLang("Rejectrowchanges");
                        })
                        .CommandName("reject")
                        .Icon(Icon.ArrowUndo)
                )
                .PrepareToolbar(t =>
                {
                    t.Handler = "toolbar.items.get(0).setVisible(record.dirty);";
                })
                .Listeners(l =>
                {
                    l.Command.Handler = "grd_Reject(record);";
                })
            )
            .SelectionModel(Html.X().RowSelectionModel().ID("slmGrid").Mode(SelectionMode.Multi))
            .Listeners(lst =>
                        {

                            lst.ContainerMouseUp.Fn = "Focus2_Change";
                            lst.Select.Fn = "Focus2_Change";
                            lst.BeforeEdit.Fn = "Focus2_Change";
                            lst.CellClick.Fn = "Focus2_Change";
                            
                        })
             .Plugins(
                                        Html.X()//Cho phep edit )
                                            .CellEditing()
                                            .ClicksToEdit(1)
                                            .Listeners(ls =>
                                            {
                                                ls.BeforeEdit.Fn = "grd_BeforeEdit";
                                                ls.Edit.Fn = "grd_Edit";
                                                ls.ValidateEdit.Fn = "grd_ValidateEdit";
                                                ls.CancelEdit.Fn = "grd_CancelEdit";
                                                
                                            })
                                    )
                                    //)           
            
        //)
        //.BottomBar(//Phan trang       
        //    Html.X().PagingToolbar().ID("PagingToolbar")
        //    .Items(
        //        Html.X().Label("Page size:"),
        //        Html.X().ToolbarSpacer(10),
        //        Html.X().ComboBox()
        //        .Width(80)
        //        .Items("1", "2", "10", "20", "30", "50")
        //        .SelectedItems("50")
        //        .Listeners(l =>
        //        {
        //            l.Select.Fn = "onComboBoxSelect";
        //        })
        //    )
        //    .Plugins(Html.X().ProgressBarPager())
        //)
    )
)
)
